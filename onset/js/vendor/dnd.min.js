!function(exports){if(window.File&&window.FileReader&&window.FileList&&window.Blob){}else{throw"Sorry, your browser doesn't support drag-and-drop file input."}var dnd=exports.dnd={version:"0.0.2"};dnd.parse={uncomment:function(parse){return function(str){var lines=str.split("\n").filter(function(line){return line.length>0&&line.charAt(0)!=="#"}).join("\n");return parse(lines)}}};dnd.parse.csv=dnd.parse.uncomment(d3.csv.parse);dnd.parse.tsv=dnd.parse.uncomment(d3.tsv.parse);dnd.file={parsers:{"text/csv":dnd.parse.csv,"text/tsv":dnd.parse.tsv,"application/json":JSON.parse},extensions:{csv:"text/csv",tsv:"text/tsv",txt:"text/csv",json:"application/json"},sizeFormats:["bytes","K","MB","GB"],formatSize:function(bytes){if(bytes<=0){return[0,dnd.file.sizeFormats[0]]}var i=~~(~~Math.log(bytes)/Math.log(1024));return[(bytes/Math.pow(1024,i)).toFixed(1),dnd.file.sizeFormats[i]].join(" ")}};dnd.guessFileType=function(file){if(file.type in dnd.file.parsers){return file.type}var ext=file.name.split(".").pop();return dnd.file.extensions[ext]};dnd.read=function(file,callback){var type=dnd.guessFileType(file),parse=dnd.file.parsers[type];if(!parse){throw"Unrecognized file type: "+type}var reader=new FileReader;reader.onload=function(e){var input=e.target.result,data=parse(input);callback.call(file,null,data)};reader.onerror=function(e){callback.call(file,e,null)};reader.readAsText(file)};dnd.dropper=function(){var ns=".dnd",dropper=function(selection){selection.on("dragover"+ns,dragover).on("dragout"+ns,dragout).on("drop"+ns,drop)},dispatch=d3.dispatch("dragover","dragout","drop","read","error");function dragover(){dispatch.dragover(d3.event);d3.event.dataTransfer.dropEffect="copy";cancel(d3.event)}function dragout(){dispatch.dragout(d3.event);cancel(d3.event)}function drop(){var files=d3.event.dataTransfer.files,len=files.length;dispatch.drop(files);cancel(d3.event);[].forEach.call(files,function(file,i){dnd.read(file,function(error,data){if(data){file.data=data}else{dispatch.error(file)}if(--len===0){dispatch.read(files)}})})}d3.rebind(dropper,dispatch,"on");return dropper};function cancel(e){e.stopPropagation();e.preventDefault()}}(this);